---
title: "R Notebook"
# output: html_notebook
editor_options: 
  chunk_output_type: console
output: 
  html_notebook: 
    fig_caption: yes
fig_width: 6 
fig_height: 4 
---

# Load libraries

```{r}
library(FIELDimageR)
library(raster)
library(rgdal)
```

# Open the orthomosaic

```{r}
EX1 <- stack("downsampled_orthos/7_6_2023_F120_Beans_P4_15m_RGB_transparent_mosaic_group1_downsample.tif")
# EX1<-aggregate(EX1, fact=4)
plotRGB(EX1, r = 1, g = 2, b =3)
```

# Remove soil pixels

```{r}
EX1.RemSoil <- fieldMask(mosaic = EX1, Red = 1, Green = 2, Blue = 3, index = "HUE")
```

# Open shapefile and add to the orthomosaic

```{r}
fieldshape <- readOGR(dsn = "shapefile/F120_beans_2023_rotated_qgis.shp", layer = "F120_beans_2023_rotated_qgis")

EX1.Shape <- fieldshape
```

# Calculate canopy cover and save to file

```{r}
EX1.Canopy<-fieldArea(mosaic = EX1.RemSoil$mask, fieldShape = EX1.Shape, n.core = 8)

write.csv(EX1.Canopy$areaPorcent, file = "EX1_Canopy_areaPorcent.csv", row.names = FALSE)
```

# Calculate vegetation indices

```{r}
EX1.Indices<- fieldIndex(mosaic = EX1.RemSoil$newMosaic, Red = 1, Green = 2, Blue = 3, 
                          index = c("NGRDI","BGI", "GLI", "BI", "SI", "VARI"))
                          
```

# Visualize the indices

```{r}
EX1.Info<- fieldInfo(mosaic = EX1.Indices,fieldShape = EX1.Shape, n.core = 8)
```

```{r}
fieldPlot(fieldShape=EX1.Info$fieldShape,fieldAttribute="VARI", mosaic=EX1, color=c("red","blue"), alpha = 0.5)
```